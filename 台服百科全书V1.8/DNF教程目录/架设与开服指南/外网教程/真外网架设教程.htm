
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>真外网架设教程</title>
<meta name="GENERATOR" content="WinCHM">
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<style>
html,body { 
	/* Default Font */
	font-family: Arial, Helvetica, sans-serif;
	font-size: 11pt;
}
</style>




<style>
html,div { margin: 0; padding: 0;}

body {
	padding: 0px;
	margin: 0px;
	overflow: auto;
	height: 100%;
}

#winchm_template_button{
	float: right;
	width: 93px;
	top: 7px;
	position: relative;
	text-align: right;
	right: 5px;
	height: auto;
}

#winchm_template_top{
	padding: 0px;
	margin: 0px;
	border-bottom: 1px solid #9B9B9B;
	background-color: #B1CEFE;
}

#winchm_template_navigation{
	margin: 0px;
	padding-top: 7px;
	padding-left: 7px;
	padding-bottom: 3px;
	padding-right: 0px;
	font-size: 8.5pt;
	font-family: Arial, Helvetica, sans-serif;
	font-weight: normal;
	color: #585858;
}

#winchm_template_title{
	margin: 0px;
	padding-top: 4px;
	padding-left: 7px;
	padding-bottom: 7px;
	padding-right: 0px;
	font-size: 18px; 
	font-family: Verdana, Geneva, sans-serif;
	color: #363636;
}

#winchm_template_content{
	margin-top: 20px;
	margin-left: 15px;
	margin-bottom: 20px;
	margin-right: 15px;
	width: auto  !important;
	width: 100%;
}

#winchm_template_footer{
	border-width: 1px;
	border-color: #B1CEFE;
	border-top-style: solid;
	margin-top: 15px;
	margin-left: 15px;
	margin-bottom: 20px;
	margin-right: 15px;
	padding-top: 7px;
	padding-left: 0px;
	padding-bottom: 0px;
	padding-right: 0px;
	font-family: arial, helvetica, sans-serif;
	font-size: 8.5pt;
	color: #696969;
	width: auto;
	text-align: left;
}


#winchm_template_container{
	margin: 0px;
	padding: 0px;
	position: static;
	padding-bottom: 3px;
	overflow: auto;
	background-color: #FFFFFF;
}


@media print
{
#winchm_template_container{
	position: static;	
	margin: 0px;
	padding: 5px;
	
	width: auto;
	height: auto;
	overflow: auto;
}
#winchm_template_button{
visibility:hidden;
}
}

#winchm_template_navigation A:link	{text-decoration: none; color:#004080}
#winchm_template_navigation A:visited  {text-decoration: none; color: #004080}
#winchm_template_navigation A:active {text-decoration: none; color: #004080 }
#winchm_template_navigation A:hover {text-decoration: none;color: #0080FF}

A:link	{text-decoration: underline; color:#0033CC}
A:visited  {text-decoration: underline; color: #0033CC}
A:active {text-decoration: underline; color: #0033CC }
A:hover {text-decoration: underline;color: #FF0000;}
</style>
<script type="text/javascript">
function isMobile(){
Agent = window.navigator.userAgent;
if (Agent.indexOf("iPhone")>=1 || Agent.indexOf("iPad")>=1 || Agent.indexOf("iPod")>=1 || Agent.indexOf("Android")>=1){
return true;
}else{
return false;	
}

}
function d_onresize(){
if (window.navigator.userAgent.indexOf("MSIE")>=1){
document.getElementById('winchm_template_container').style.pixelWidth = document.body.offsetWidth - 3;
document.getElementById('winchm_template_container').style.pixelHeight = document.body.offsetHeight - document.getElementById('winchm_template_top').offsetHeight - 4;
}
document.getElementById('winchm_template_container').style.top = document.getElementById('winchm_template_top').offsetHeight + 'px';
}

function d_onbeforeprint(){
document.getElementById('winchm_template_container').style.width = 'auto';
document.getElementById('winchm_template_container').style.height = 'auto';
}

function d_onafterprint(){
d_onresize();
}

if(!isMobile()){

window.onload = d_onresize;
window.onresize = d_onresize;
window.onbeforeprint = d_onbeforeprint;
window.onafterprint = d_onafterprint;





}

</script>
</head>

<body>

<div id="winchm_template_top">
	<div id="winchm_template_button"><A href="../外网教程.htm" title="Previous topic"><img id="winchm_template_prev" alt="Previous topic" src="../../../template2/btn_prev_n.gif" border="0"></a><A href="真外网架设视频教程.htm" title="Next topic"><img id="winchm_template_next" alt="Next topic" src="../../../template2/btn_next_n.gif" border="0"></a></div>
	<div id="winchm_template_navigation"><a href="index.html">Help</a> &gt; 
<A href="../../../$$unsavedpage14.htm">架设/开服指南</A> &gt; <A href="../外网教程.htm">外网教程</A> &gt; </div>
	<div id="winchm_template_title">真外网架设教程</div>
</div>
<div id="winchm_template_container">
	<div id="winchm_template_content">
<P>&nbsp; 真外网搭设教程<BR>作者 三叶虫<BR>贴吧ID sycspysycspy<BR>首先感谢&lt;<A 
href="http://tieba.baidu.com/p/4014133222">http://tieba.baidu.com/p/4014133222</A>&gt; 
这个帖子的作者 外网搭设的主要思路都是按照他的。登录器也可以用那个楼主发出来的。<BR>我这边用的登录器是这个 --&gt; 链接：&lt;<A 
href="http://pan.baidu.com/s/1pJ25WsN">http://pan.baidu.com/s/1pJ25WsN</A>&gt; 
密码：rghq<BR>登录器都有自己配对的publickey注意去服务端替换不然会造成无限连接频道的问题。<BR>需要用到的修复文件参考：&lt;<A 
href="http://tieba.baidu.com/p/4030210821">http://tieba.baidu.com/p/4030210821</A>&gt;<BR>这个教程是给自己开单机没啥问题的双数据端的同学， 
单数据的没试过。自己连单机都架不好的请绕道去找DNF台服学院的教程，那个作者孙悟空是个人物，教程很详细但是到外网的环节还是萎了。。。<BR>下面正式开始教程：<BR>1.修改数据库的db_connect当中的IP</P>
<P><IMG alt="" src="../../../images/真外网架设教程01.jpg">&nbsp; 
<BR>&nbsp;<BR>在192.168.1.160（如果你是按UAT的网络搭建的单机而且使用的是默认的IP设置的前提）。其实这里连接localhost是一码事儿。点击右键选择命令列界面<BR>&nbsp;</P>
<P><IMG alt="" src="../../../images/真外网架设教程02.jpg"> </P>
<P><BR>use 
d_taiwan;<BR>mysql&gt; update db_connect set db_ip = 
'192.168.1.160';<BR>mysql&gt; update DBLAB_db_connect_130516 set db_ip = 
'192.168.1.160';<BR>复制粘贴这几个脚本然后按回车，如果运行成功会看到如上图中的结果。<BR>同样在192.168.1.200的连接执行一样的脚本。<BR><STRONG><FONT color=#ff0000>这里插一杠子做一点路由器的设置</FONT></STRONG>：为了尽量减少修改我把本地的ip设置成<FONT color=#ff0000><STRONG>192.168.1.160</STRONG></FONT>，这样后来的config神马的修改会省很多事儿。也强烈建议你这么做。你只要知道192.168.1.160 
是数据库就好了！<BR>至于怎么把本地ip设置成192.168.1.160捏：<BR>打开浏览器输入你的路由器地址，这个不同的网络可能会有出去，但通常是<A 
href="http://192.168.1.1/">http://192.168.1.1/</A> 或者<A 
href="http://192.168.0.1/">http://192.168.0.1/</A> 之类的。</P>
<P> 
 
不知道的话去网络适配器右键选择状态，然后按详细信息</P>
<P><IMG alt="" src="../../../images/真外网架设教程03.jpg"> 
 
</P>
<P><BR>&nbsp;<BR>通常网关就是你的路由器ip。物理地址就是MAC地址，后面路由器设置中可能需要。<BR> 
 
路由器的设置界面也大相径庭，在这里我只能给大家看看我自己的</P>
<P><IMG alt="" src="../../../images/真外网架设教程04.jpg"> 
 
</P>
<P><BR>&nbsp;<BR>在DHCP的设置中添加了一条，MAC地址就是网卡的物理地址。设置成功的话每次连接到路由器都会自动分配给该机器为192.168.1.160。不管这里你改不改成160，预定ip地址的步骤还是有必要做得，不然每次已连接就换个ip也够你受的。既然都来了就顺便把路由器的地址也改一下吧</P>
<P><IMG alt="" src="../../../images/真外网架设教程05.jpg"> 
 
</P>
<P><BR>&nbsp;<BR>这里我改成了<STRONG><FONT color=#ff0000>192.168.1.1</FONT></STRONG>，也推荐你这么做 
这个后面还会用到。<BR><BR><STRONG>2. 
设置虚拟机为bridged</STRONG> 
 
</P>
<P><STRONG></STRONG>&nbsp;</P>
<P><STRONG><IMG alt="" src="../../../images/真外网架设教程06.jpg"></P>
<P> <BR></STRONG>&nbsp;<BR>首先来到虚拟机的Virtual Network Editor 找到Vmnet0 适配器 
设置桥接到（bridge 
to）为你上网用的网卡。然后点击应用，确定。</P>
<P><IMG alt="" src="../../../images/真外网架设教程07.jpg"> 
 
</P>
<P>   
   
<BR>&nbsp;<BR>来到虚拟机设置，在网卡环节选择自定义然后选vmnet0（桥接）。<BR>然后来到网络适配器的设置界面<BR> 
 
&nbsp;</P>
<P><IMG alt="" src="../../../images/真外网架设教程08.jpg"> 
 
</P>
<P><BR>把除了你设置桥接的其他网卡（vmnet1 
和 vmnet8就够了）都禁用掉。<BR><BR><STRONG>3. 
更改配置文件</STRONG> 
 
</P><STRONG>
<P> 
<BR></STRONG>下载修复文件，地址写在开头，下载解压。但是我们还要改一改才能用：<BR>修改channel\cfg\channel.cfg文件：</P>
<P><IMG alt="" src="../../../images/真外网架设教程09.jpg"> 
 
</P>
<P><BR>&nbsp; 
<BR>这里只需要改一处，将this_ip改成你的外网ip，你的外网ip怎么看捏 可以用这个网站&lt;<A 
href="http://ip.51240.com/">http://ip.51240.com/</A>&gt; 类似的网站一大把 
也可以百度一下。<BR>然后去game\cfg 这里有三个文件要改 分别为cain01（1频道） cain02（ 
11频道）和cain03（52PK频道）。想要基本的游戏功能cain02必须要改，就拿cain02当例子吧:<BR>ip<BR>udp_ip_of_hades<BR>udp_ip_of_hades 
<BR>ipg_ip <BR>nxj_ipg_ip <BR>relay_ip 
<BR>stun_ip<BR>stun_ip<BR> 
 
stun_ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P> 
<BR>这些地方后面的192.168.1.200必须改为你的外网ip 
不然连不上频道或者组不了队。其他的两个文件也是一样的改。另外如果没有将本机ip设为192.168.1.160的同学还需要改master_db_ip， 
把他改成你的本地ip。</P>
<P><IMG alt="" src="../../../images/真外网架设教程10.jpg"> </P>
<P><BR>改完以后登录winscp，选择这些东西复制到虚拟机。那个导入sql数据库文件的过程我就不说了。大家都该有经验了。。<BR>服务端的配置文件到此结束。<BR><BR><STRONG><FONT color=#ff0000>接下来我们要改一改centos的配置了，这个东西貌似很多人不愿意透露（目测是故意的，想钱想疯了，或者是开私服的秘密）。这个步骤非常非常非常的重要</FONT></STRONG> </P><STRONG><FONT color=#ff0000>
<P><BR></FONT></STRONG>在winscp里找到/etc/sysconfig<BR>里面有一个network文件，把GATEWAY的地址改为你的路由器的地址就像下面那样<BR>NETWORKING=yes<BR>NETWORKING_IPV6=no<BR>HOSTNAME=www.abc.com<BR>GATEWAY=<FONT color=#ff0000>192.168.1.1</FONT></P><FONT color=#ff0000>
<P><BR></FONT>接下来找到/etc/sysconfig/network-scripts<BR>里面有个ifcfg-eth0， 这个文件修改成下面这样。</P>
<P> 
<BR># Advanced Micro Devices [AMD] 79c970 [PCnet32 
LANCE]<BR>DEVICE=eth0<BR>BOOTPROTO=static<BR>BROADCAST=192.168.1.255<BR>IPADDR=192.168.1.200<BR>NETMASK=255.255.255.0<BR>NETWORK=192.168.1.0<BR>GATEWAY=<FONT color=#ff0000>192.168.1.1<BR></FONT>ONBOOT=yes<BR>USERCTL=yes </P>
<P><BR>修改完了记得<FONT color=#ff0000>保存<BR></FONT>然后跑到vmware里面 
执行一段命令<BR>service network restart 如果全都改对了你会看到四个OK。中间出现Invalid 
argument的话可能你改的有地方不对<BR>改完以后试试ping <A 
href="http://www.baidu.com">www.baidu.com</A> 
如果ping通了说明你改的没啥问题。这个很重要，很多外网连不上都是死在这里了。<BR>致此所有配置文件修改完毕。<BR><BR><STRONG>4. 
路由器端口映射</STRONG> </P><STRONG>
<P> 
<BR></STRONG>这个环节大家自己想办法，我们的路由器都不一样所以操作步骤也各不相同，但是需要映射的端口都是一定的：<BR>这些是192.168.1.200 
需要映射的端口：<BR>7001 &nbsp;&nbsp;&nbsp;选区的界面，如果你的区灰了，检查这个问题<BR>10001 
&nbsp;&nbsp;&nbsp;1频道 这个频道从来没用过<BR>10011 &nbsp;&nbsp;&nbsp;11频道 
如果进不去11频道检查这里的配置<BR>10031 &nbsp;&nbsp;&nbsp;52频道 
如果进不去pk场检查这里的设置<BR>下面这坨应该是组队相关的<BR>31001&nbsp;&nbsp; <BR>9006<BR>7200<BR>2311 
<BR>2312 <BR>2313<BR>我的路由器映射之后是这样：</P>
<P><IMG alt="" src="../../../images/真外网架设教程11.jpg"><BR> </P>
<P><IMG alt="" src="../../../images/真外网架设教程12.jpg">&nbsp; </P>
<P>路由器这里大家的都不一样，我实在是没啥好说的。除了游戏端口我还映射了apache server和登录器网关的接口 82 
和10165。这些如果你用我推荐的网关也是必要的步骤。其他登录器请参考相应的说明。</P>
<P>如果你服务器开起来了，而且端口都映射对了。去浏览器输入 <STRONG><FONT color=#ff0000>你的外网ip:10011</FONT></STRONG>  
会下载一个download文件。如果下不到说明上面的哪个步骤没有作对。<BR><BR>对了还忘了一件事儿。<STRONG><FONT color=#ff0000>如果出现局域网上的电脑看得到频道而连不进去的情况</FONT></STRONG></P>
<P><STRONG><FONT color=#ff0000><IMG alt="" src="../../../images/真外网架设教程13.jpg"></P>
<P><BR></FONT></STRONG>&nbsp;<BR>去160的数据库 
找到d_taiwan 下面的geo_reject，你会发现路由器的地址被拒了。<BR><BR>去geo_allow 
添加路由器的地址，允许的国家代码按自己的情况设定。哥是个海外狗所以别跟着哥来。<BR>&nbsp;<BR>&nbsp;<IMG alt="" src="../../../images/真外网架设教程14.jpg"></P>
<P><IMG alt="" src="../../../images/真外网架设教程15.jpg"></P>
<P><BR><STRONG>5. 结语</STRONG></P>
<P><STRONG> 
<BR></STRONG>哥痛恨伸手党，死也不做伸手党。遇到不会东西都是能找到教程就看教程，找不到就自己琢磨，实在没办法了才找人请教，但是通常石沉大海，没有结果，求人不如求己啊。望各位同僚也能像其他大神一样，少一点伸手，多一点钻研的精神。如果有何建议或疑问请各位在贴吧讨论，不接受私聊，本人不做任何有偿或义务的搭建服务。<BR></P></div>	
	<div id="winchm_template_footer">Copyright &copy; 2014. All rights 
reserved. (To change the copyright info, just edit it in template.)</div>
</div>

</body>
</html>
